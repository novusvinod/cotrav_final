{% extends 'Company/Admin/layout/header.html' %}

{% block content %}

{% for Dashboard in dataDashboard %}
{% if user %}
{% include 'cotrav_alert_message.html' %}

<!-- start page content -->
            <div class="page-content-wrapper">
                <div class="page-content">


			               		<div class="row state-overview">
				                  <div class="col-lg-2">
			                        <div class="info-box bg-b-purple">
							            <span class="info-box-icon"><i class="material-icons">person</i></span>
							            <div class="info-box-content">
							              <span class="info-box-text" >Total Active Users</span>
							              <span class="info-box-number">{{Dashboard.total_active_users}}</span>
							            </div>
							          </div>
								  </div>

									<div class="col-lg-2">
			                        <div class="info-box bg-b-green">
							            <span class="info-box-icon"><i class="material-icons">alarm_on</i></span>
							            <div class="info-box-content">
							              <span class="info-box-text">Total Bookings Done</span>
							              <span class="info-box-number">{{Dashboard.total_bookings_count}}</span>
							            </div>
							          </div>
								  </div>

									<div class="col-lg-2">
			                        <div class="info-box bg-b-black">
							            <span class="info-box-icon"><i class="material-icons">new_releases</i></span>
							            <div class="info-box-content">
							              <span class="info-box-text">Upcoming Trips</span>
							              <span class="info-box-number">{{Dashboard.uc_total_bookings_count}}</span>
							            </div>
							          </div>
								  </div>

									<div class="col-lg-2">
			                        <div class="info-box bg-b-yellow">
							            <span class="info-box-icon"><i class="material-icons">report</i></span>
							            <div class="info-box-content">
							              <span class="info-box-text">Bookings- Pending</span>
							              <span class="info-box-number">{{Dashboard.tom_total_bookings_count}}</span>
							            </div>
							          </div>
								  </div>

									<div class="col-lg-2">
			                        <div class="info-box bg-b-blue">
							            <span class="info-box-icon"><i class="material-icons">info</i></span>
							            <div class="info-box-content">
							              <span class="info-box-text">Invoice- Pending</span>
							              <span class="info-box-number">{{Dashboard.pi_total_bookings_count}}</span>
							            </div>
							          </div>
								  </div>


									<div class="col-lg-2">
			                        <div class="info-box bg-b-green">
							            <span class="info-box-icon"><i class="material-icons">local_atm</i></span>
							            <div class="info-box-content">
							              <span class="info-box-text">Total Invoice Amount</span>
							              <span class="info-box-number">{{Dashboard.total_invoice_amount}}</span>
							            </div>
							          </div>
								  </div>

		                    </div>



                 <div class="row">
                        <div class="col-md-3">
                            <div class="card card-topline-lightblue">
                                <div class="card-head">
                                    <header>Total Bookings Done</header>
                                    <div class="tools">
                                        <a class="fa fa-repeat btn-color box-refresh" href="javascript:;"></a>
	                                    <a class="t-collapse btn-color fa fa-chevron-down" href="javascript:;"></a>
	                                    <a class="t-close btn-color fa fa-times" href="javascript:;"></a>
                                    </div>
                                </div>
                                <div class="card-body ">
                                    <div class="row">
                                         <canvas id="canvasTaxiBookings" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>

                     <div class="col-md-3">
                            <div class="card card-topline-lightblue">
                                <div class="card-head">
                                    <header>Total Upcomming Bookings</header>
                                    <div class="tools">
                                        <a class="fa fa-repeat btn-color box-refresh" href="javascript:;"></a>
	                                    <a class="t-collapse btn-color fa fa-chevron-down" href="javascript:;"></a>
	                                    <a class="t-close btn-color fa fa-times" href="javascript:;"></a>
                                    </div>
                                </div>
                                <div class="card-body ">
                                    <div class="row">
                                         <canvas id="canvasUCBookings" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>


					   <div class="col-md-3">
                            <div class="card card-topline-lightblue">
                                <div class="card-head">
                                    <header>Invoice Pending</header>
                                    <div class="tools">
                                        <a class="fa fa-repeat btn-color box-refresh" href="javascript:;"></a>
	                                    <a class="t-collapse btn-color fa fa-chevron-down" href="javascript:;"></a>
	                                    <a class="t-close btn-color fa fa-times" href="javascript:;"></a>
                                    </div>
                                </div>
                                <div class="card-body " id="chartjs_pie_parent3">
                                    <div class="row">
                                         <canvas id="canvasTOMBookings" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>


					   <div class="col-md-3">
                            <div class="card card-topline-lightblue">
                                <div class="card-head">
                                    <header>Invoice Amount</header>
                                    <div class="tools">
                                        <a class="fa fa-repeat btn-color box-refresh" href="javascript:;"></a>
	                                    <a class="t-collapse btn-color fa fa-chevron-down" href="javascript:;"></a>
	                                    <a class="t-close btn-color fa fa-times" href="javascript:;"></a>
                                    </div>
                                </div>
                                <div class="card-body " id="chartjs_pie_parent2">
                                    <div class="row">
                                         <canvas id="canvasTOMBookings1" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>


		<div class="row">

			<div class="col-md-6">

                            <div class="card card-topline-lightblue">
                                <div class="card-head">
                                    <header>Six Months Sales Summary</header>
                                    <div class="tools">
                                        <a class="fa fa-repeat btn-color box-refresh" href="javascript:;"></a>
	                                    <a class="t-collapse btn-color fa fa-chevron-down" href="javascript:;"></a>
	                                    <a class="t-close btn-color fa fa-times" href="javascript:;"></a>
                                    </div>
                                </div>
                                <div class="card-body " >
                                    <div class="row">
                                        <div class="tools" id="result-graph-container">

                                        <select name="month" id="month">
                                            <option value="1">Jan</option>
                                            <option value="2">Feb</option>
                                            <option value="3">Mar</option>
                                            <option value="4">Apr</option>
                                            <option value="5">May</option>
                                            <option value="6">Jun</option>
                                            <option value="7">Jul</option>
                                            <option value="8">Aug</option>
                                            <option value="9">Sep</option>
                                            <option value="10">Oct</option>
                                            <option value="11">Nov</option>
                                            <option value="12">Dec</option>
                                        </select>

                                        <select name="year" id="year">
                                            <option value="2010">2010</option>
                                            <option value="2011">2011</option>
                                            <option value="2012">2012</option>
                                            <option value="2013">2013</option>
                                            <option value="2014">2014</option>
                                            <option value="2015">2015</option>
                                            <option value="2016">2016</option>
                                            <option value="2017">2017</option>
                                            <option value="2018">2018</option>
                                            <option value="2019">2019</option>
                                            <option value="2020" selected >2020</option>
                                        </select>



                                        <!--<button onclick="callMonthWiseSummery(2020,1)">Months View</button>-->

                                        </div>

                                        <canvas id="chart-by-months" ></canvas>
                                        <!--<canvas id="chartjs_bar2"></canvas>-->
                                        <div class="tools">
                                        <span onclick="prev()"><i class="fa fa-arrow-circle-left fa-3x" ></i></span>
                                        <span onclick="next()"><i class="fa fa-arrow-circle-right fa-3x" ></i></span>

                                        <input type="hidden" name="yr" id="yr" value="2019">
                                        <input type="hidden" name="mnt" id="mnt" value="7">

                                        </div>

                                    </div>
                                </div>
                            </div>

                       </div>

			<div class="col-md-6">

                            <div class="card card-topline-lightblue">
                                <div class="card-head">
                                    <header>Top Four Cities Sales Summary</header>
                                    <div class="tools">
                                        <a class="fa fa-repeat btn-color box-refresh" href="javascript:;"></a>
	                                    <a class="t-collapse btn-color fa fa-chevron-down" href="javascript:;"></a>
	                                    <a class="t-close btn-color fa fa-times" href="javascript:;"></a>
                                    </div>
                                </div>
                                <div class="card-body " id="chartjs_bar_parent">
                                    <div class="row">

                                     <div class="tools" id="result-graph-container2">

                                       <!-- <select name="month" id="month2">
                                            <option value="1">Jan</option>
                                            <option value="2">Feb</option>
                                            <option value="3">Mar</option>
                                            <option value="4">Apr</option>
                                            <option value="5">May</option>
                                            <option value="6">Jun</option>
                                            <option value="7">Jul</option>
                                            <option value="8">Aug</option>
                                            <option value="9">Sep</option>
                                            <option value="10">Oct</option>
                                            <option value="11">Nov</option>
                                            <option value="12">Dec</option>
                                        </select>

                                        <select name="year" id="year2">
                                            <option value="2010">2010</option>
                                            <option value="2011">2011</option>
                                            <option value="2012">2012</option>
                                            <option value="2013">2013</option>
                                            <option value="2014">2014</option>
                                            <option value="2015">2015</option>
                                            <option value="2016">2016</option>
                                            <option value="2017">2017</option>
                                            <option value="2018">2018</option>
                                            <option value="2019">2019</option>
                                            <option value="2020" selected >2020</option>
                                        </select> -->



                                        <!--<button onclick="callMonthWiseSummery(2020,1)">Months View</button>-->

                                        </div>



                                        <canvas id="graph-by-city" ></canvas>



                                    </div>
                                </div>
                            </div>

                       </div>

		</div>


		 <div class="row">

                        <div class="col-md-6">

                             <div class="card card-topline-lightblue">
                                <div class="card-head">
                                    <header>Six Months Booking Summary</header>
                                    <div class="tools">
                                        <a class="fa fa-repeat btn-color box-refresh" href="javascript:;"></a>
	                                    <a class="t-collapse btn-color fa fa-chevron-down" href="javascript:;"></a>
	                                    <a class="t-close btn-color fa fa-times" href="javascript:;"></a>
                                    </div>
                                </div>
                                <div class="card-body " >
                                    <div class="row">
                                        <div class="tools" id="result-graph-container-3">

                                        <select name="month" id="month3">
                                            <option value="1">Jan</option>
                                            <option value="2">Feb</option>
                                            <option value="3">Mar</option>
                                            <option value="4">Apr</option>
                                            <option value="5">May</option>
                                            <option value="6">Jun</option>
                                            <option value="7">Jul</option>
                                            <option value="8">Aug</option>
                                            <option value="9">Sep</option>
                                            <option value="10">Oct</option>
                                            <option value="11">Nov</option>
                                            <option value="12">Dec</option>
                                        </select>

                                        <select name="year" id="year3">
                                            <option value="2010">2010</option>
                                            <option value="2011">2011</option>
                                            <option value="2012">2012</option>
                                            <option value="2013">2013</option>
                                            <option value="2014">2014</option>
                                            <option value="2015">2015</option>
                                            <option value="2016">2016</option>
                                            <option value="2017">2017</option>
                                            <option value="2018">2018</option>
                                            <option value="2019">2019</option>
                                            <option value="2020" selected >2020</option>
                                        </select>



                                        <!--<button onclick="callMonthWiseSummery(2020,1)">Months View</button>-->

                                        </div>

                                        <canvas id="booking-chart-by-months" ></canvas>
                                        <!--<canvas id="chartjs_bar2"></canvas>-->
                                        <div class="tools">
                                        <span onclick="prev3()"><i class="fa fa-arrow-circle-left fa-3x" ></i></span>
                                        <span onclick="next3()"><i class="fa fa-arrow-circle-right fa-3x" ></i></span>

                                        <input type="hidden" name="yr" id="yr-3" value="2019">
                                        <input type="hidden" name="mnt" id="mnt-3" value="7">

                                        </div>

                                    </div>
                                </div>
                            </div>



                        </div>


                        <div class="col-md-6">

                             <div class="card card-topline-lightblue">
                                <div class="card-head">
                                    <header>Tax Amount Summary</header>
                                    <div class="tools">
                                        <a class="fa fa-repeat btn-color box-refresh" href="javascript:;"></a>
	                                    <a class="t-collapse btn-color fa fa-chevron-down" href="javascript:;"></a>
	                                    <a class="t-close btn-color fa fa-times" href="javascript:;"></a>
                                    </div>
                                </div>
                                <div class="card-body " >
                                    <div class="row">

                                          <div class="tools" id="result-graph-container-4">

                                              <b>From Date: </b> <input type = "date" id="from_date" name="from_datetime" >

                                              <b>To Date: </b><input   type = "date" id="to_date" name="to_datetime" >



                                        </div>


                                        <div id="table-data" >

                                            <table class="table">
  <thead>
    <tr>
      <th scope="col">Service Type</th>
      <th scope="col">Pre-tax Amount</th>
      <th scope="col" colspan="3" style="text-align:center;">GST</th>
      <th scope="col">Others</th>
      <th scope="col">Total</th>
      <th scope="col" colspan="3" style="text-align:center;">Payment Status</th>

    </tr>
    <tr>
      <th scope="col"></th>
      <th scope="col">

        <th scope="col">IGST</th>
        <th scope="col">CGST</th>
        <th scope="col">SGST</th>

      </th>
      <th scope="col"></th>
      <th scope="col"></th>
      <th scope="col">

        <th scope="col">Paid</th>
        <th scope="col">Pending</th>
        <th scope="col">Partial Paid</th>

      </th>
    </tr>
  </thead>
  <tbody>
    <tr id="row_hotel">

      <th scope="row">Hotel</th>
      <td></td>
      <td>
        <td></td>
        <td></td>
        <td></td>
      </td>
      <td></td>
      <td>
        <td></td>
        <td></td>
        <td></td>
      </td>

    </tr>
    <tr id="row_bus">

      <th scope="row">Bus</th>
      <td></td>
      <td>
        <td></td>
        <td></td>
        <td></td>
      </td>
      <td></td>
      <td>
        <td></td>
        <td></td>
        <td></td>
      </td>
    </tr>
    <tr id="row_train">

      <th scope="row">Train</th>
      <td></td>
      <td>
        <td></td>
        <td></td>
        <td></td>
      </td>
      <td></td>
      <td>
        <td></td>
        <td></td>
        <td></td>
      </td>
    </tr>
  <tr id="row_flight">

      <th scope="row">Flight</th>
      <td></td>
      <td>
        <td></td>
        <td></td>
        <td></td>
      </td>
      <td></td>
      <td>
        <td></td>
        <td></td>
        <td></td>
      </td>
    </tr>
  <tr id="row_taxi">

      <th scope="row">Taxi</th>
      <td></td>
      <td>
        <td></td>
        <td></td>
        <td></td>
      </td>
      <td></td>
      <td>
        <td></td>
        <td></td>
        <td></td>
      </td>
    </tr>
  </tbody>
</table>



                                        </div>
                                        <!--<canvas id="chartjs_bar2"></canvas>-->


                                    </div>
                                </div>
                            </div>



                        </div>








                    </div>



    <!--Chart JS-->
{% load static %}
    <script src="{% static 'assets/plugins/chart-js/Chart.bundle.js' %}" ></script>
    <script src="{% static 'assets/plugins/chart-js/utils.js' %}" ></script>

{% else %}
    <p>Welcome, new user. Please log in.<a href="/login">Login</a> </p>
{% endif %}

<script>

	/*Taxi Bookings*/
	  var ctx = document.getElementById("canvasTaxiBookings");
	  var data = {
		labels: ["Taxi","Bus","Train","Hotel","Flight"],
		datasets: [{
            data: [{{Dashboard.taxi_bookings_count}},{{Dashboard.bus_bookings_count}},{{Dashboard.train_bookings_count}},{{Dashboard.hotel_bookings_count}},{{Dashboard.flight_bookings_count}}],
           backgroundColor: ["#455C73","#9B59B6","#BDC3C7","#26B99A","#3498DB"],
		  hoverBackgroundColor: ["#34495E","#B370CF","#CFD4D8","#36CAAB","#49A9EA"]

		}]
	  };
	  var canvasUCBookings = new Chart(ctx, {
		type: 'doughnut',
		tooltipFillColor: "rgba(51, 51, 51, 0.55)",
		data: data
	  });



	/*Upcoming Bookings*/
	  var ctx = document.getElementById("canvasUCBookings");
	  var data = {
		labels: ["Taxi","Bus","Train","Hotel","Flight"],
		datasets: [{
		  data: [{{Dashboard.uc_taxi_bookings_count}},{{Dashboard.uc_bus_bookings_count}},{{Dashboard.uc_train_bookings_count}},{{Dashboard.uc_hotel_bookings_count}},{{Dashboard.uc_flight_bookings_count}}],
		  backgroundColor: ["#455C73","#9B59B6","#BDC3C7","#26B99A","#3498DB"],
		  hoverBackgroundColor: ["#34495E","#B370CF","#CFD4D8","#36CAAB","#49A9EA"]

		}]
	  };
	  var canvasUCBookings = new Chart(ctx, {
		type: 'doughnut',
		tooltipFillColor: "rgba(51, 51, 51, 0.55)",
		data: data
	  });


	  	   /*Today/Tomorrow Bookings*/
	  var ctx = document.getElementById("canvasTOMBookings");
	  var data = {
		labels: ["Taxi","Bus","Train","Hotel","Flight"],
		datasets: [{
		  data: [{{Dashboard.pi_taxi_bookings_count}},{{Dashboard.pi_bus_bookings_count}},{{Dashboard.pi_train_bookings_count}},{{Dashboard.pi_hotel_bookings_count}},{{Dashboard.pi_flight_bookings_count}}],
		  backgroundColor: ["#455C73","#9B59B6","#BDC3C7","#26B99A","#3498DB"],
		  hoverBackgroundColor: ["#34495E","#B370CF","#CFD4D8","#36CAAB","#49A9EA"]

		}]
	  };
	  var canvasTOMBookings = new Chart(ctx, {
		type: 'doughnut',
		tooltipFillColor: "rgba(51, 51, 51, 0.55)",
		data: data
	  });



	  	   /*Today/Tomorrow Bookings*/
	  var ctx = document.getElementById("canvasTOMBookings1");
	  var data = {
		labels: ["Taxi","Bus","Train","Hotel","Flight"],
		datasets: [{
		  data: [{{Dashboard.taxi_invoice_amount}},{{Dashboard.bus_invoice_amount}},{{Dashboard.train_invoice_amount}},{{Dashboard.hotel_invoice_amount}},{{Dashboard.flight_invoice_amount}}],
		  backgroundColor: ["#455C73","#9B59B6","#BDC3C7","#26B99A","#3498DB"],
		  hoverBackgroundColor: ["#34495E","#B370CF","#CFD4D8","#36CAAB","#49A9EA"]

		}]
	  };
	  var canvasTOMBookings = new Chart(ctx, {
		type: 'doughnut',
		tooltipFillColor: "rgba(51, 51, 51, 0.55)",
		data: data
	  });

</script>

<script>

$('#year').change(callChartByMonth);

$('#month').change(callChartByMonth);


function callChartByMonth(){

 var month = $("#month :selected").val();
    var year = $("#year :selected").val();

 var_url = '/api/'+'dashboard_sales_by_month'
    $.ajaxSetup({
            headers:{
                'Authorization': "Token {{request.session.agent_access_token}}",
                'usertype': 10
            }

        });

$.post(var_url,{'month':month,'year':year},
      function(data)
      {

       taxi_dt = parseInt(data['Sales'][0].taxi);
       bus_dt = parseInt(data['Sales'][0].bus);
       train_dt = parseInt(data['Sales'][0].train);
       flight_dt = parseInt(data['Sales'][0].flight);
       hotel_dt = parseInt(data['Sales'][0].hotel);

      /* barChartData.datasets[0].data = [ taxi_dt ];
       barChartData.datasets[1].data = [ bus_dt ];
       barChartData.datasets[2].data = [ train_dt ];
       barChartData.datasets[3].data = [ flight_dt ];
       barChartData.datasets[4].data = [ hotel_dt ];*/

       ChartByMonth(taxi_dt,bus_dt,train_dt,flight_dt,hotel_dt);


       });

}

    function ChartByMonth(taxi_dt,bus_dt,train_dt,flight_dt,hotel_dt){

     if (typeof window.myBar1 != "undefined")
        {
        window.myBar1.destroy();

        }else{

        //alert("not exist");

        }


    var mnt = parseInt($("#month :selected").val());
    var year = parseInt($("#year :selected").val());

    var MONTHS = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
     var color = Chart.helpers.color;

     month = MONTHS[mnt-1];

       var barChartData = {
         labels: [month],
         datasets: [{
             label: 'Taxi',
             backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
             borderColor: window.chartColors.red,
             borderWidth: 1,
             data: [
                taxi_dt
             ]
         }, {
             label: 'Bus',
             backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
             borderColor: window.chartColors.blue,
             borderWidth: 1,
             data: [
                bus_dt
             ]
         },{
             label: 'Train',
             backgroundColor: color(window.chartColors.green).alpha(0.5).rgbString(),
             borderColor: window.chartColors.green,
             borderWidth: 1,
             data: [
                train_dt
             ]
         },{
             label: 'Flight',
             backgroundColor: color(window.chartColors.pink).alpha(0.5).rgbString(),
             borderColor: window.chartColors.pink,
             borderWidth: 1,
             data: [
                flight_dt
             ]
         },{
             label: 'Hotel',
             backgroundColor: color(window.chartColors.yellow).alpha(0.5).rgbString(),
             borderColor: window.chartColors.yellow,
             borderWidth: 1,
             data: [
                hotel_dt
             ]
         }

         ]

     };

        title_text = month + ' Salesss Summery'

         var ctxx = document.getElementById("chart-by-months").getContext("2d");
         window.myBar1 = new Chart(ctxx, {
             type: 'bar',
             data: barChartData,
             scaleOverride : true,
             scaleSteps : 10,
             scaleStepWidth : 50,
             scaleStartValue : 0,
             options: {
             scaleLabel: function(value){
        var val = value.value;
    	if (val >= 10000000) val = (val / 10000000).toFixed(2) + ' Cr';
        else if (val >= 100000) val = (val / 100000).toFixed(2) + ' Lac';
        else if (val >= 1000) val = (val / 1000).toFixed(2) + ' K';
        return val;
    },
                scales: {
                            yAxes: [{
                        scaleLabel: {
                        display: true,
                        labelString: 'Sales  In  Lacs'

                                    }
                                    }]
                        },
                 responsive: true,
                 legend: {
                     position: 'top',
                 },
                 title: {
                     display: true,
                     text: title_text
                 }
             }
         });

    }
</script>



<script>

function getDate(){


    var today = new Date();

document.getElementById("to_date").value = today.getFullYear() + '-' + ('0' + (today.getMonth() + 1)).slice(-2) + '-' + ('0' + today.getDate()).slice(-2);


}



function callChartByCity(){

//alert("city chart");

 var serveType = $("#serveType :selected").val();


 var_url = '/api/'+'admin_dashboard_sales_by_city'
    $.ajaxSetup({
            headers:{
                'Authorization': "Token {{request.session.admin_access_token}}",
                'usertype': 1
            }

        });

$.post(var_url,{'service_types':1},
      function(data)
      {

        taxi_x = [];
        taxi_y = [];

        bus_x = [];
        bus_y = [];

        train_x = [];
        train_y = [];

        flight_x = [];
        flight_y = [];

        hotel_x = [];
        hotel_y = [];

        var v_x = 0;
        var v_y = 0;


       for (k=0;k<data['Sales'].length;k++)
        {
            switch(k){

            case 0:

            console.log(data['Sales'][k]);

            for (i=0;i<data['Sales'][k].length;i++)
            {
            v_x = data['Sales'][k][i].cities;
            v_y = parseInt(data['Sales'][k][i].taxi_total);
            taxi_x.push(v_x);
            taxi_y.push(v_y);
            }

                break;

            case 1:
            console.log(data['Sales'][k]);

            for (i=0;i<data['Sales'][k].length;i++)
            {
                v_x = data['Sales'][k][i].cities;
                v_y = parseInt(data['Sales'][k][i].bus_total);
                bus_x.push(v_x);
                bus_y.push(v_y);
            }
                break;

            case 2:
            console.log(data['Sales'][k]);

            for (i=0;i<data['Sales'][k].length;i++)
            {
                    v_x = data['Sales'][k][i].cities;
                    v_y = parseInt(data['Sales'][k][i].train_total);
                    train_x.push(v_x);
                    train_y.push(v_y);
            }
                break;

            case 3:
            console.log(data['Sales'][k]);

            for (i=0;i<data['Sales'][k].length;i++)
            {
                    v_x = data['Sales'][k][i].city;
                    v_y = parseInt(data['Sales'][k][i].flight_total);

                    flight_x.push(v_x);
                    flight_y.push(v_y);


            }

                break;

            case 4:
            console.log(data['Sales'][k]);
            for (i=0;i<data['Sales'][k].length;i++)
            {
                    v_x = data['Sales'][k][i].city;
                    v_y = parseInt(data['Sales'][k][i].hotel_total);
                    hotel_x.push(v_x);
                    hotel_y.push(v_y);
            }

                break;


                        }

         }

         for ( i = 0 ; i < 5 ; i++ )
         {
            console.log('########');
            console.log(taxi_x[i]);
            console.log(taxi_y[i]);
            console.log('############');


         }

         console.log(flight_x);
         console.log(flight_y);

       ChartByCity(taxi_x,taxi_y,bus_x,bus_y,train_x,train_y,flight_x,flight_y,hotel_x,hotel_y);


       });

}

function ChartByCity(taxi_x,taxi_y,bus_x,bus_y,train_x,train_y,flight_x,flight_y,hotel_x,hotel_y){

   // alert('ChartByCity');

    console.log('### city data ###');
    console.log(taxi_x);
    console.log(taxi_y);
    console.log(bus_x);
    console.log(bus_y);
    console.log(train_x);
    console.log(train_y);
    console.log(flight_x);
    console.log(flight_y);
    console.log(hotel_x);
    console.log(hotel_y);

    console.log(flight_x[0]);
    console.log(flight_y[0]);
    console.log('### end city data ###');

     if (typeof window.myBar22 != "undefined")
        {
        window.myBar22.destroy();

        }else{

        //alert("not exist");

        }


    var mnt = parseInt($("#month :selected").val());
    var year = parseInt($("#year :selected").val());

    var MONTHS = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
    var color = Chart.helpers.color;

     month = MONTHS[mnt-1];

     label1 = '';
     label2 = '';
     label3 = '';
     label4 = '';
     label5 = '';

       var barChartData22 = {
         labels: ['TAXI','BUS','TRAIN','FLIGHT','HOTEL'],
        datasets: [
         {
             label: label1,
             backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
             borderColor: window.chartColors.red,
             borderWidth: 1,
             data: [taxi_y[0],bus_y[0],train_y[0],flight_y[0],hotel_y[0]],
             city_data: [taxi_x[0],bus_x[0],train_x[0],flight_x[0],hotel_x[0]]
         }, {
             label: label2,
             backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
             borderColor: window.chartColors.blue,
             borderWidth: 1,
             data: [taxi_y[1],bus_y[1],train_y[1],flight_y[1],hotel_y[1]],
             city_data: [taxi_x[1],bus_x[1],train_x[1],flight_x[1],hotel_x[1]]
         },{
             label: label3,
             backgroundColor: color(window.chartColors.orange).alpha(0.5).rgbString(),
             borderColor: window.chartColors.orange,
             borderWidth: 1,
             data: [taxi_y[2],bus_y[2],train_y[2],flight_y[2],hotel_y[2]],
             city_data: [taxi_x[2],bus_x[2],train_x[2],flight_x[2],hotel_x[2]]
         },{
             label: label4,
             backgroundColor: color(window.chartColors.pink).alpha(0.5).rgbString(),
             borderColor: window.chartColors.pink,
             borderWidth: 1,
             data: [taxi_y[3],bus_y[3],train_y[3],flight_y[3],hotel_y[3]],
             city_data: [taxi_x[3],bus_x[3],train_x[3],flight_x[3],hotel_x[3]]
         }

         ]

     };

       // title_text =' Sales Summary For '+ MONTHS[mnt] + '-' + year + '' ;

       title_text ='Top Four City By Sales';

         var ctx22 = document.getElementById("graph-by-city").getContext("2d");

         window.myBar22 = new Chart(ctx22, {
            type: 'horizontalBar',

             data: barChartData22,
             options: {

             maintainAspectRatio: true,

             "animation": {
                            "duration": 1,
                            "onComplete": function() {


                                                        var chartInstance = this.chart,
                                                        ctx = chartInstance.ctx;

                                                        var height = chartInstance.controller.boxes[0].bottom;

                                                        //ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontSize, Chart.defaults.global.defaultFontStyle, Chart.defaults.global.defaultFontFamily);
                                                        ctx.font = "10px Georgia";
                                                        ctx.textAlign = 'center';
                                                        ctx.textBaseline = 'bottom';
                                                        //ctx.rotate(Math.PI*2/(i*6));

                            this.data.datasets.forEach(function(dataset, i) {
                                                              var meta = chartInstance.controller.getDatasetMeta(i);


                                                              meta.data.forEach(function(bar, index) {
                                                                var data = dataset.data[index];
                                                                console.log("bar print");
                                                                console.log(bar._index);

                                                                //var lbl = data.datasets[tooltipItem.index].city_data;
                                                                var lbl = dataset.city_data;
                                                                console.log("city dataset issss");
                                                                console.log(lbl);
                                                                var lbl_cityname = lbl[bar._index];
                                                                console.log("city name isss");
                                                                console.log(lbl_cityname);

                                                                //ctx.fillText( lbl_cityname , bar._model.x, height - ((height - bar._model.y) / 2));
                                                               ctx.fillText(lbl_cityname, bar._model.x + 20, bar._model.y + 5);




                                                              });
                                                            });
                                                          }
                                                        },
                                                        legend: {
                                                           "position" : 'top',
                                                          "display": false
                                                        },
                                                        tooltips: {
                                                          "enabled": true
                                                        },

                legend: {
            display: false,
        },
                scales: {
                           yAxes: [{

                            categoryPercentage : 1,
			                barPercentage: 0.6,

             scaleLabel: {
                        display: true,
                        labelString: 'Total Sales In Lacs'
                                    },


		}]
                        },
                 tooltips: {

                 enabled: false,

            callbacks: {
                label: function(tooltipItem, data) {
                    var label = data.datasets[tooltipItem.datasetIndex].label || '';
                    var lbl = data.datasets[tooltipItem.index].city_data;
                    var lbl_cityname = lbl[tooltipItem.index];
                    if (label) {
                        label += ': ';
                    }
                    //label += Math.round(tooltipItem.yLabel * 100) / 100;
                    label += lbl_cityname;
                    return label;
                }
            }
        },
                 responsive: true,
                 legend: {
                     position: 'top',
                 },
                 title: {
                     display: true,
                     text: title_text
                 }
             }
         });

    }

$('#year2').change(callChartByCityForMonth);

$('#month2').change(callChartByCityForMonth);

function callChartByCityForMonth(){

 var serveType = $("#serveType :selected").val();
 var month = $("#month2 :selected").val();
    var year = $("#year2 :selected").val();



 var_url = '/api/'+'admin_dashboard_sales_by_city_for_month'
    $.ajaxSetup({
            headers:{
                'Authorization': "Token {{request.session.admin_access_token}}",
                'usertype': 1
            }

        });

$.post(var_url,{'service_types':serveType,'year':year,'month':month},
      function(data)
      {

        taxi_x = [];
        taxi_y = [];

        bus_x = [];
        bus_y = [];

        train_x = [];
        train_y = [];

        flight_x = [];
        flight_y = [];

        hotel_x = [];
        hotel_y = [];

        var v_x = 0;
        var v_y = 0;


       for (k=0;k<data['Sales'].length;k++)
        {
            switch(k){

            case 0:

            console.log(data['Sales'][k]);

            for (i=0;i<data['Sales'][k].length;i++)
            {
            v_x = data['Sales'][k][i].cities;
            v_y = parseInt(data['Sales'][k][i].taxi_total);
            taxi_x.push(v_x);
            taxi_y.push(v_y);
            }

                break;

            case 1:
            console.log(data['Sales'][k]);

            for (i=0;i<data['Sales'][k].length;i++)
            {
                v_x = data['Sales'][k][i].cities;
                v_y = parseInt(data['Sales'][k][i].bus_total);
                bus_x.push(v_x);
                bus_y.push(v_y);
            }
                break;

            case 2:
            console.log(data['Sales'][k]);

            for (i=0;i<data['Sales'][k].length;i++)
            {
                    v_x = data['Sales'][k][i].cities;
                    v_y = parseInt(data['Sales'][k][i].train_total);
                    train_x.push(v_x);
                    train_y.push(v_y);
            }
                break;

            case 3:
            console.log(data['Sales'][k]);

            for (i=0;i<data['Sales'][k].length;i++)
            {
                    v_x = data['Sales'][k][i].city;
                    v_y = parseInt(data['Sales'][k][i].flight_total);

                    flight_x.push(v_x);
                    flight_y.push(v_y);


            }

                break;

            case 4:
            console.log(data['Sales'][k]);
            for (i=0;i<data['Sales'][k].length;i++)
            {
                    v_x = data['Sales'][k][i].city;
                    v_y = parseInt(data['Sales'][k][i].hotel_total);
                    hotel_x.push(v_x);
                    hotel_y.push(v_y);
            }

                break;


                        }

         }

         for ( i = 0 ; i < 5 ; i++ )
         {
            console.log('########');
            console.log(taxi_x[i]);
            console.log(taxi_y[i]);
            console.log('############');


         }

         console.log(flight_x);
         console.log(flight_y);

       ChartByCityForMonth(taxi_x,taxi_y,bus_x,bus_y,train_x,train_y,flight_x,flight_y,hotel_x,hotel_y);


       });

}

function ChartByCityForMonth(taxi_x,taxi_y,bus_x,bus_y,train_x,train_y,flight_x,flight_y,hotel_x,hotel_y){

    console.log('### city data ###');
    console.log(taxi_x);
    console.log(taxi_y);
    console.log(bus_x);
    console.log(bus_y);
    console.log(train_x);
    console.log(train_y);
    console.log(flight_x);
    console.log(flight_y);
    console.log(hotel_x);
    console.log(hotel_y);

    console.log(flight_x[0]);
    console.log(flight_y[0]);
    console.log('### end city data ###');

     if (typeof window.myBar22 != "undefined")
        {
        window.myBar22.destroy();

        }else{

        //alert("not exist");

        }


    var mnt = parseInt($("#month :selected").val());
    var year = parseInt($("#year :selected").val());

    var MONTHS = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
     var color = Chart.helpers.color;

     month = MONTHS[mnt-1];

     label1 = '';
     label2 = '';
     label3 = '';
     label4 = '';
     label5 = '';

       var barChartData22 = {
         labels: ['TAXI','BUS','TRAIN','FLIGHT','HOTEL'],
         datasets: [
         {
             label: label1,
             backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
             borderColor: window.chartColors.red,
             borderWidth: 1,
             data: [taxi_y[0],bus_y[0],train_y[0],flight_y[0],hotel_y[0]],
             city_data: [taxi_x[0],taxi_x[1],taxi_x[2],taxi_x[3],taxi_x[4]]
         }, {
             label: label2,
             backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
             borderColor: window.chartColors.blue,
             borderWidth: 1,
             data: [taxi_y[1],bus_y[1],train_y[1],flight_y[1],hotel_y[1]],
             city_data: [bus_x[0],bus_x[1],bus_x[2],bus_x[3],bus_x[4]]
         },{
             label: label3,
             backgroundColor: color(window.chartColors.orange).alpha(0.5).rgbString(),
             borderColor: window.chartColors.blue,
             borderWidth: 1,
             data: [taxi_y[2],bus_y[2],train_y[2],flight_y[2],hotel_y[2]],
             city_data: [train_x[0],train_x[1],train_x[2],train_x[3],train_x[4]]
         },{
             label: label4,
             backgroundColor: color(window.chartColors.pink).alpha(0.5).rgbString(),
             borderColor: window.chartColors.pink,
             borderWidth: 1,
             data: [taxi_y[3],bus_y[3],train_y[3],flight_y[3],hotel_y[3]],
             city_data: [flight_x[0],flight_x[1],flight_x[2],flight_x[3],flight_x[4]]
         },{
             label: label5,
             backgroundColor: color(window.chartColors.pink).alpha(0.5).rgbString(),
             borderColor: window.chartColors.pink,
             borderWidth: 1,
             data: [taxi_y[4],bus_y[4],train_y[4],flight_y[4],hotel_y[4]],
             city_data: [hotel_x[0],hotel_x[1],hotel_x[2],hotel_x[3],hotel_x[4]]
         }

         ]

     };

        title_text =' Sales Summary'

          var ctx22 = document.getElementById("graph-by-city").getContext("2d");
         window.myBar22 = new Chart(ctx22, {
             type: 'bar',
             data: barChartData22,
             options: {

              "animation": {
                            "duration": 1,
                            "onComplete": function() {
                                                        var chartInstance = this.chart,
                                                        ctx = chartInstance.ctx;

                                                        ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontSize, Chart.defaults.global.defaultFontStyle, Chart.defaults.global.defaultFontFamily);
                                                        ctx.textAlign = 'center';
                                                        ctx.textBaseline = 'bottom';

                            this.data.datasets.forEach(function(dataset, i) {
                                                              var meta = chartInstance.controller.getDatasetMeta(i);
                                                              meta.data.forEach(function(bar, index) {
                                                                var data = dataset.data[index];
                                                                Math.round(Number(data)) == 0 ?

                                                                ctx.fillText('', bar._model.x, bar._model.y - 10) :

                                                                ctx.fillText(data, bar._model.x, bar._model.y - 10);

                                                              });
                                                            });
                                                          }
                                                        },
                                                        legend: {
                                                           position: 'top',
                                                          "display": false
                                                        },
                                                        tooltips: {
                                                          "enabled": true
                                                        },



                scales: {
                            yAxes: [{
                        scaleLabel: {
                        display: true,
                        labelString: 'Sales  In  Lacs'

                                    }
                                    }]
                        },
                 tooltips: {
            callbacks: {
                label: function(tooltipItem, data) {

                    var label = data.datasets[tooltipItem.datasetIndex].label || '';
                    var lbl = data.datasets[tooltipItem.index].city_data;
                    var lbl_cityname = lbl[tooltipItem.datasetIndex];
                    if (label) {
                        label += ': ';
                    }
                    //label += Math.round(tooltipItem.yLabel * 100) / 100;
                    label += lbl_cityname;
                    return label;
                }
            }
        },
                 responsive: true,
                 legend: {
                     position: 'top',
                 },
                 title: {
                     display: true,
                     text: title_text
                 }
             }
         });

    }


</script>


<script>

    $(document).ready(function() {

    var d = new Date();

    var date = d.getDate();
    var month = d.getMonth() + 1; // Since getMonth() returns month from 0-11 not 1-12
    var year = d.getFullYear();

    v_yr = parseInt(year);
    v_month = parseInt(month);

    document.getElementById("yr").value = v_yr;
    document.getElementById("mnt").value = v_month;

     document.getElementById("yr-3").value = v_yr;
    document.getElementById("mnt-3").value = v_month;

    callMonthWiseSummery(v_yr,v_month);

    callMonthWiseBookingsSummery(v_yr,v_month);

    //city_wise_summery();

    callChartByCity();

     var today_date = new Date();

 var six_month_back = moment().subtract(180, 'days').calendar();

 var date2 = new Date(six_month_back);

today_date_value = today_date.getFullYear()  + '-' + ('0' + (today_date.getMonth() + 1)).slice(-2) + '-' + ('0' + today_date.getDate()).slice(-2) ;

date3 = date2.getFullYear()  + '-' + ('0' + (date2.getMonth() + 1)).slice(-2) + '-' + ('0' + date2.getDate()).slice(-2) ;

 var from_date = date3;

 var to_date = today_date_value;

document.getElementById("to_date").defaultValue = to_date;
document.getElementById("from_date").defaultValue = from_date;

    callTaxAmountTable(from_date,to_date);


	});

</script>

<script>

function slice2(array, chunk, offset) {
    var subarray = [];
    for (var i = 0; i<chunk; i++) {
        var ind = (offset + i) % array.length;
        subarray.push(array[ind]);
    }

    return subarray;
}

function next(){
    v_yr = parseInt(document.getElementById("yr").value);
    v_month = parseInt(document.getElementById("mnt").value);
    console.log('####');
    console.log(v_yr);
    console.log(v_month);
    console.log('####');


    if (v_month == 12)
    {
        document.getElementById("mnt").value = 1;
        document.getElementById("yr").value = v_yr + 1 ;
        v_month = 1;
        v_yr = v_yr + 1 ;
    }else{
        document.getElementById("mnt").value = v_month+1;
        v_month = v_month+1;
    }

    //ctx1.destroy();
    callMonthWiseSummery(v_yr,v_month);
}

function prev(){
    v_yr = parseInt(document.getElementById("yr").value);
    v_month = parseInt(document.getElementById("mnt").value);
    console.log('####');
    console.log(v_yr);
    console.log(v_month);
    console.log('####');

    if (v_month == 1)
    {
        document.getElementById("mnt").value = 12;
        document.getElementById("yr").value = v_yr - 1;
        v_month = 12;
        v_yr = v_yr -1 ;
    }else{

        document.getElementById("mnt").value = v_month-1;

        v_month = v_month-1;
    }

    //ctx1.destroy();
    callMonthWiseSummery(v_yr,v_month);
}


function callMonthWiseSummery(yr,mnt)
    {

      var today = new Date();

 curr_yr = parseInt(today.getFullYear()) ;
 curr_month = parseInt(today.getMonth() + 1) ;

 if( (yr == curr_yr) && (mnt == curr_month) )
 {
   //document.getElementById("next").disabled = true;

   $('#next').hide();

 }else{

 //document.getElementById("next").disabled = false;

 $('#next').show();

 }


        var_url = '/api/'+'admin_dashboard_sales_for_six_months'
    $.ajaxSetup({
            headers:{
                'Authorization': "Token {{request.session.admin_access_token}}",
                'usertype': 1
            }

        });

$.post(var_url,{'year':yr,'month':mnt},
      function(data)
      {

         var chk = mnt;

        taxi_ar = [];
        bus_ar = [];
        train_ar = [];
        flight_ar = [];
        hotel_ar = [];

        taxi_yr_ar = [];
        bus_yr_ar = [];
        train_yr_ar = [];
        flight_yr_ar = [];
        hotel_yr_ar = [];

        var chk_ar = [];
        var chkk_ar = [];


        chk_ar.push(chk);
        taxi_ar.push(chk);
        bus_ar.push(chk);
        train_ar.push(chk);
        flight_ar.push(chk);
        hotel_ar.push(chk);
        for(i=1;i<=5;i++)
        {
            if(chk == 1)
            {
                chk = 13;
            }
            chk--;
            taxi_ar.push(chk);
            bus_ar.push(chk);
            train_ar.push(chk);
            flight_ar.push(chk);
            hotel_ar.push(chk);

            chk_ar.push(chk);

        }

        console.log('## date array is ###')
        console.log(chk_ar);
        console.log('## end ###')
        taxi_arr = [];
        bus_arr = [];
        train_arr = [];
        flight_arr = [];
        hotel_arr = [];

        chk_arr = [];
        taxi = [];
        bus = [];
        train = [];
        flight = [];
        hotel = [];
        console.log('###');
        console.log(data['Sales']);

        for (k=0;k<data['Sales'].length;k++)
        {


            switch(k){

            case 0:
            for (i=0;i<data['Sales'][k].length;i++)
            {
               var a = taxi_ar.indexOf(data['Sales'][k][i].m);

                if ( a != -1 )
                {
                taxi_ar[a] = data['Sales'][k][i].taxi_total;
                taxi_arr.push(a);
                }

            }

                break;

            case 1:
             for (i=0;i<data['Sales'][k].length;i++)
            {
             console.log(data['Sales'][k][i].m);
               var a = bus_ar.indexOf(data['Sales'][k][i].m);
                if ( a != -1 )
                {
                bus_ar[a] = data['Sales'][k][i].bus_total;
                bus_arr.push(a);
                }

             }

                break;

            case 2:

              for (i=0;i<data['Sales'][k].length;i++)
            {

            var a = train_ar.indexOf(data['Sales'][k][i].m);
                if ( a != -1 )
                {
                train_ar[a] = data['Sales'][k][i].train_total;
                train_arr.push(a);
                }

            }

                break;

            case 3:

              for (i=0;i<data['Sales'][k].length;i++)
            {

            var a = flight_ar.indexOf(data['Sales'][k][i].m);
                if ( a != -1 )
                {
                flight_ar[a] = data['Sales'][k][i].flight_total;
                flight_arr.push(a);
                }

            }

                break;

            case 4:

              for (i=0;i<data['Sales'][k].length;i++)
            {

            var a = hotel_ar.indexOf(data['Sales'][k][i].m);
                if ( a != -1 )
                {
                hotel_ar[a] = data['Sales'][k][i].hotel_total;
                hotel_arr.push(a);
                }

            }

                break;

                    }



        }



        for(l=1;l<=5;l++)
        {


        switch(l) {
  case 1:

    for (j=0;j<taxi_ar.length;j++)
        {
        //val = taxi_ar[j];

        b = taxi_arr.indexOf(j);
            if ( b == -1 )
            {
            taxi_ar[j] = 0;
            }

        }



    break;
  case 2:
    for (j=0;j<bus_ar.length;j++)
        {

        //val = bus_ar[j];

        b = bus_arr.indexOf(j);
            if ( b == -1 )
            {
            bus_ar[j] = 0;
            }

        }
    break;
  case 3:
    for (j=0;j<train_ar.length;j++)
        {

        //val = train_ar[j];

        b = train_arr.indexOf(j);
            if ( b == -1 )
            {
            train_ar[j] = 0;
            }

        }
    break;
  case 4:
    for (j=0;j<flight_ar.length;j++)
        {

       // val = flight_ar[j];

        b = flight_arr.indexOf(j);
            if ( b == -1 )
            {
            flight_ar[j] = 0;
            }

        }
    break;
  case 5:
    for (j=0;j<hotel_ar.length;j++)
        {
           // val = flight_ar[j];

        b = hotel_arr.indexOf(j);
            if ( b == -1 )
            {
            hotel_ar[j] = 0;
            }

        }
    break;

  default:
    // code block

}



        }

        taxi = taxi_ar.reverse();
        bus = bus_ar.reverse();
        train = train_ar.reverse();
        flight = flight_ar.reverse();
        hotel = hotel_ar.reverse();


        month_wise_summery(taxi,bus,train,flight,hotel,yr,mnt,chk_ar);


       });

    }




function month_wise_summery(taxi,bus,train,flight,hotel,yr,mnt,chk_ar) {

    var MONTHS = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];


if(chk_ar[5] > 1)
{
mnth = parseInt(chk_ar[5]-1);
}else{
mnth = parseInt(12);
}
ar = slice2(MONTHS,6,mnth);

//ar = [MONTHS[chk_ar[0]],MONTHS[chk_ar[1]],MONTHS[chk_ar[2]],MONTHS[chk_ar[3]],MONTHS[chk_ar[4]],MONTHS[chk_ar[5]]]

//alert(ar);

//alert(current);


     var color = Chart.helpers.color;
     var barChartData = {
         labels: ar,
         datasets: [{
             label: 'Taxi',
             backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
             borderColor: window.chartColors.red,
             borderWidth: 1,
             data: [
                 taxi[0],taxi[1],taxi[2],taxi[3],taxi[4],taxi[5]
             ]
         }, {
             label: 'Bus',
             backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
             borderColor: window.chartColors.blue,
             borderWidth: 1,
             data: [
                bus[0],bus[1],bus[2],bus[3],bus[4],bus[5]
             ]
         },{
             label: 'Train',
             backgroundColor: color(window.chartColors.orange).alpha(0.5).rgbString(),
             borderColor: window.chartColors.green,
             borderWidth: 1,
             data: [
                 train[0],train[1],train[2],train[3],train[4],train[5]
             ]
         },{
             label: 'Flight',
             backgroundColor: color(window.chartColors.pink).alpha(0.5).rgbString(),
             borderColor: window.chartColors.pink,
             borderWidth: 1,
             data: [
                 flight[0],flight[1],flight[2],flight[3],flight[4],flight[5]
             ]
         },{
             label: 'Hotel',
             backgroundColor: color(window.chartColors.yellow).alpha(0.5).rgbString(),
             borderColor: window.chartColors.yellow,
             borderWidth: 1,
             data: [
                 hotel[0],hotel[1],hotel[2],hotel[3],hotel[4],hotel[5]
             ]
         }

         ]

     };

        if (typeof window.myBar1 != "undefined")
        {
        // object exists

        //alert("exist");

        window.myBar1.destroy();

        }else{

        //alert("not exist");

        }



         var ctx1 = document.getElementById("chart-by-months").getContext("2d");
         window.myBar1 = new Chart(ctx1, {
             type: 'bar',

             data: barChartData,

             options: {

             suggestedMin:0,
             suggestedMax:15,

              "animation": {
                            "duration": 1,
                            "onComplete": function() {
                                                        var chartInstance = this.chart,
                                                        ctx = chartInstance.ctx;

                                                        ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontSize, Chart.defaults.global.defaultFontStyle, Chart.defaults.global.defaultFontFamily);
                                                        ctx.textAlign = 'center';
                                                        ctx.textBaseline = 'bottom';

                            this.data.datasets.forEach(function(dataset, i) {
                                                              var meta = chartInstance.controller.getDatasetMeta(i);
                                                              meta.data.forEach(function(bar, index) {
                                                                var data = dataset.data[index];
                                                                Math.round(Number(data)) == 0 ?

                                                                ctx.fillText('', bar._model.x, bar._model.y - 10) :

                                                                ctx.fillText(data, bar._model.x, bar._model.y - 10);

                                                              });
                                                            });
                                                          }
                                                        },
                                                        legend: {
                                                           position: 'top',
                                                          "display": false
                                                        },
                                                        tooltips: {
                                                          "enabled": true
                                                        },

                scales: {
                            yAxes: [{

                        scaleLabel: {
                        display: true,
                        labelString: 'Total Sales In Lacs'
                                    }

                                    }]
                        },
                 responsive: true,

                 title: {
                     display: true,
                     text: 'Six Months Sales Summary'
                 }
             }
         });


         }




</script>

<script>

/* javascript for booking summery */

    function next3(){

    v_yr = parseInt(document.getElementById("yr-3").value);
    v_month = parseInt(document.getElementById("mnt-3").value);
    console.log('####');
    console.log(v_yr);
    console.log(v_month);
    console.log('####');


    if (v_month == 12)
    {
        document.getElementById("mnt-3").value = 1;
        document.getElementById("yr-3").value = v_yr + 1 ;
        v_month = 1
    }else{
        document.getElementById("mnt-3").value = v_month+1;
        v_month = v_month+1;
    }

    //ctx1.destroy();
    callMonthWiseBookingsSummery(v_yr,v_month);
}

function prev3(){
    v_yr = parseInt(document.getElementById("yr-3").value);
    v_month = parseInt(document.getElementById("mnt-3").value);
    console.log('####');
    console.log(v_yr);
    console.log(v_month);
    console.log('####');

    if (v_month == 1)
    {
        document.getElementById("mnt-3").value = 12;
        document.getElementById("yr-3").value = v_yr - 1;
        v_month = 12;
    }else{

        document.getElementById("mnt-3").value = v_month-1;

        v_month = v_month-1;
    }

    //ctx1.destroy();
    callMonthWiseBookingsSummery(v_yr,v_month);
}

    function callMonthWiseBookingsSummery(yr,mnt)
    {

        var_url = '/api/'+'admin_dashboard_bookings_for_six_months'
    $.ajaxSetup({
            headers:{
                'Authorization': "Token {{request.session.admin_access_token}}",
                'usertype': 1
            }

        });

$.post(var_url,{'year':yr,'month':mnt},
      function(data)
      {

        //alert(data);

         var chk = mnt;

        taxi_ar = [];
        bus_ar = [];
        train_ar = [];
        flight_ar = [];
        hotel_ar = [];

        var chk_ar = [];
        var chkk_ar = [];


        chk_ar.push(chk);
        taxi_ar.push(chk);
        bus_ar.push(chk);
        train_ar.push(chk);
        flight_ar.push(chk);
        hotel_ar.push(chk);
        for(i=1;i<=5;i++)
        {
            if(chk == 1)
            {
                chk = 13;
            }
            chk--;
            taxi_ar.push(chk);
            bus_ar.push(chk);
            train_ar.push(chk);
            flight_ar.push(chk);
            hotel_ar.push(chk);

            chk_ar.push(chk);

        }

        console.log(chk_ar);
        taxi_arr = [];
        bus_arr = [];
        train_arr = [];
        flight_arr = [];
        hotel_arr = [];

        chk_arr = [];
        taxi = [];
        bus = [];
        train = [];
        flight = [];
        hotel = [];
        console.log('###');
        console.log(data['Sales']);

        for (k=0;k<data['Sales'].length;k++)
        {
        for (i=0;i<data['Sales'][k].length;i++)
        {

            switch(k){

            case 0:
            var a = taxi_ar.indexOf(data['Sales'][k][i].m);
                if ( a != -1 )
                {
                taxi_ar[a] = data['Sales'][k][i].taxi_total;
                taxi_arr.push(a);
                }

                break;

            case 1:
             console.log(data['Sales'][k][i].m);
            var a = bus_ar.indexOf(data['Sales'][k][i].m);
                if ( a != -1 )
                {
                bus_ar[a] = data['Sales'][k][i].bus_total;
                bus_arr.push(a);
                }

                break;

            case 2:

            var a = train_ar.indexOf(data['Sales'][k][i].m);
                if ( a != -1 )
                {
                train_ar[a] = data['Sales'][k][i].train_total;
                train_arr.push(a);
                }

                break;

            case 3:

            var a = flight_ar.indexOf(data['Sales'][k][i].m);
                if ( a != -1 )
                {
                flight_ar[a] = data['Sales'][k][i].flight_total;
                flight_arr.push(a);
                }

                break;

            case 4:

            var a = hotel_ar.indexOf(data['Sales'][k][i].m);
                if ( a != -1 )
                {
                hotel_ar[a] = data['Sales'][k][i].hotel_total;
                hotel_arr.push(a);
                }

                break;

                    }

        }

        }



        for(l=1;l<=5;l++)
        {


        switch(l) {
  case 1:

    for (j=0;j<taxi_ar.length;j++)
        {

        b = taxi_arr.indexOf(j);
            if ( b == -1 )
            {
            taxi_ar[j] = 0;
            }

        }
    break;
  case 2:
    for (j=0;j<bus_ar.length;j++)
        {

        b = bus_arr.indexOf(j);
            if ( b == -1 )
            {
            bus_ar[j] = 0;
            }

        }
    break;
  case 3:
    for (j=0;j<train_ar.length;j++)
        {

        b = train_arr.indexOf(j);
            if ( b == -1 )
            {
            train_ar[j] = 0;
            }

        }
    break;
  case 4:
    for (j=0;j<flight_ar.length;j++)
        {

        b = flight_arr.indexOf(j);
            if ( b == -1 )
            {
            flight_ar[j] = 0;
            }

        }
    break;
  case 5:
    for (j=0;j<hotel_ar.length;j++)
        {

        b = hotel_arr.indexOf(j);
            if ( b == -1 )
            {
            hotel_ar[j] = 0;
            }

        }
    break;
  default:
    // code block

}



        }

        taxi = taxi_ar.reverse();
        bus = bus_ar.reverse();;
        train = train_ar.reverse();;
        flight = flight_ar.reverse();;
        hotel = hotel_ar.reverse();;


        month_wise_bookings_summery(taxi,bus,train,flight,hotel,yr,mnt,chk_ar);


       });





    }


    function month_wise_bookings_summery(taxi,bus,train,flight,hotel,yr,mnt,chk_ar) {

    var MONTHS = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];



if(chk_ar[5] > 1)
{
mnth = parseInt(chk_ar[5]-1);
}else{
mnth = parseInt(12);
}
ar = slice2(MONTHS,6,mnth);

//ar = [MONTHS[chk_ar[0]],MONTHS[chk_ar[1]],MONTHS[chk_ar[2]],MONTHS[chk_ar[3]],MONTHS[chk_ar[4]],MONTHS[chk_ar[5]]]

//alert(ar);

//alert(current);


     var color = Chart.helpers.color;
     var barChartData3 = {
         labels: ar,
         datasets: [{
             label: 'Taxi',
             backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
             borderColor: window.chartColors.red,
             borderWidth: 1,
             data: [
                 taxi[0],taxi[1],taxi[2],taxi[3],taxi[4],taxi[5]
             ]
         }, {
             label: 'Bus',
             backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
             borderColor: window.chartColors.blue,
             borderWidth: 1,
             data: [
                bus[0],bus[1],bus[2],bus[3],bus[4],bus[5]
             ]
         },{
             label: 'Train',
             backgroundColor: color(window.chartColors.orange).alpha(0.5).rgbString(),
             borderColor: window.chartColors.green,
             borderWidth: 1,
             data: [
                 train[0],train[1],train[2],train[3],train[4],train[5]
             ]
         },{
             label: 'Flight',
             backgroundColor: color(window.chartColors.pink).alpha(0.5).rgbString(),
             borderColor: window.chartColors.pink,
             borderWidth: 1,
             data: [
                 flight[0],flight[1],flight[2],flight[3],flight[4],flight[5]
             ]
         },{
             label: 'Hotel',
             backgroundColor: color(window.chartColors.yellow).alpha(0.5).rgbString(),
             borderColor: window.chartColors.yellow,
             borderWidth: 1,
             data: [
                 hotel[0],hotel[1],hotel[2],hotel[3],hotel[4],hotel[5]
             ]
         }

         ]

     };

        if (typeof window.myBar3 != "undefined")
        {

        window.myBar3.destroy();

        }else{

        //alert("not exist");

        }



         var ctx3 = document.getElementById("booking-chart-by-months").getContext("2d");
         window.myBar3 = new Chart(ctx3, {
             type: 'bar',
             data: barChartData3,
             options: {
              "animation": {
                            "duration": 1,
                            "onComplete": function() {
                                                        var chartInstance = this.chart,
                                                        ctx = chartInstance.ctx;

                                                        ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontSize, Chart.defaults.global.defaultFontStyle, Chart.defaults.global.defaultFontFamily);
                                                        ctx.textAlign = 'center';
                                                        ctx.textBaseline = 'bottom';

                            this.data.datasets.forEach(function(dataset, i) {
                                                              var meta = chartInstance.controller.getDatasetMeta(i);
                                                              meta.data.forEach(function(bar, index) {
                                                                var data = dataset.data[index];
                                                                Math.round(Number(data)) == 0 ?

                                                                ctx.fillText('', bar._model.x, bar._model.y - 10) :

                                                                ctx.fillText(data, bar._model.x, bar._model.y - 10);

                                                              });
                                                            });
                                                          }
                                                        },
                                                        legend: {
                                                          "display": false
                                                        },
                                                        tooltips: {
                                                          "enabled": true
                                                        },



                scales: {
                            yAxes: [{
                        scaleLabel: {
                        display: true,
                        labelString: 'Total No Of Bookings'
                                    }
                                    }]
                        },
                 responsive: true,
                 legend: {
                     position: 'top',
                 },
                 title: {
                     display: true,
                     text: 'Six Months Bookings Summary'
                 }
             }
         });


         }



</script>

<script>

$('#year3').change(callBookingsChartByMonth);

$('#month3').change(callBookingsChartByMonth);

function callBookingsChartByMonth(){

 var month = $("#month3 :selected").val();
    var year = $("#year3 :selected").val();

 var_url = '/api/'+'dashboard_bookings_by_month'
    $.ajaxSetup({
            headers:{
                'Authorization': "Token {{request.session.agent_access_token}}",
                'usertype': 10
            }

        });

$.post(var_url,{'month':month,'year':year},
      function(data)
      {

       taxi_dt = parseInt(data['Sales'][0].taxi);
       bus_dt = parseInt(data['Sales'][0].bus);
       train_dt = parseInt(data['Sales'][0].train);
       flight_dt = parseInt(data['Sales'][0].flight);
       hotel_dt = parseInt(data['Sales'][0].hotel);

      /* barChartData.datasets[0].data = [ taxi_dt ];
       barChartData.datasets[1].data = [ bus_dt ];
       barChartData.datasets[2].data = [ train_dt ];
       barChartData.datasets[3].data = [ flight_dt ];
       barChartData.datasets[4].data = [ hotel_dt ];*/

       BookingsChartByMonth(taxi_dt,bus_dt,train_dt,flight_dt,hotel_dt);


       });

}

    function BookingsChartByMonth(taxi_dt,bus_dt,train_dt,flight_dt,hotel_dt){

     if (typeof window.myBar3 != "undefined")
        {
        window.myBar3.destroy();

        }else{

        //alert("not exist");

        }


    var mnt = parseInt($("#month :selected").val());
    var year = parseInt($("#year :selected").val());

    var MONTHS = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
     var color = Chart.helpers.color;

     month = MONTHS[mnt-1];

       var barChartData4 = {
         labels: [month],
         datasets: [{
             label: 'Taxi',
             backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
             borderColor: window.chartColors.red,
             borderWidth: 1,
             data: [
                taxi_dt
             ]
         }, {
             label: 'Bus',
             backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
             borderColor: window.chartColors.blue,
             borderWidth: 1,
             data: [
                bus_dt
             ]
         },{
             label: 'Train',
             backgroundColor: color(window.chartColors.green).alpha(0.5).rgbString(),
             borderColor: window.chartColors.green,
             borderWidth: 1,
             data: [
                train_dt
             ]
         },{
             label: 'Flight',
             backgroundColor: color(window.chartColors.pink).alpha(0.5).rgbString(),
             borderColor: window.chartColors.pink,
             borderWidth: 1,
             data: [
                flight_dt
             ]
         },{
             label: 'Hotel',
             backgroundColor: color(window.chartColors.yellow).alpha(0.5).rgbString(),
             borderColor: window.chartColors.yellow,
             borderWidth: 1,
             data: [
                hotel_dt
             ]
         }

         ]

     };

        title_text = month + ' Bookings Summery'

         var ctx3 = document.getElementById("booking-chart-by-months").getContext("2d");
         window.myBar3 = new Chart(ctx3, {
             type: 'bar',
             data: barChartData4,
             options: {

              "animation": {
                            "duration": 1,
                            "onComplete": function() {
                                                        var chartInstance = this.chart,
                                                        ctx = chartInstance.ctx;

                                                        ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontSize, Chart.defaults.global.defaultFontStyle, Chart.defaults.global.defaultFontFamily);
                                                        ctx.textAlign = 'center';
                                                        ctx.textBaseline = 'bottom';

                            this.data.datasets.forEach(function(dataset, i) {
                                                              var meta = chartInstance.controller.getDatasetMeta(i);
                                                              meta.data.forEach(function(bar, index) {
                                                                var data = dataset.data[index];

                                                                Math.round(Number(data)) == 0 ?

                                                                ctx.fillText('', bar._model.x, bar._model.y - 10) :

                                                                ctx.fillText(data, bar._model.x, bar._model.y - 10);

                                                              });
                                                            });
                                                          }
                                                        },
                                                        legend: {
                                                          "display": false
                                                        },
                                                        tooltips: {
                                                          "enabled": true
                                                        },


                scales: {
                          yAxes: [{
                           scaleLabel: {
                        display: true,
                        labelString: 'Total Number Of Bookings'
                                    },
                            display: true,
                            gridLines: {
                              display: true
                            },

                          }],
                          xAxes: [{
                            gridLines: {
                              display: true
                            },
                            ticks: {
                              beginAtZero: true
                            }
                          }]
                        },

                 responsive: true,
                 legend: {
                     position: 'top',
                 },
                 title: {
                     display: true,
                     text: title_text
                 }
             }
         });

    }


</script>



<script>

/* js for tax amount summery table */

$('#from_date').change(TaxAmountTable);

$('#to_date').change(TaxAmountTable);

function nullCheck(val)
{
     if(typeof val === 'undefined') {
                    val = 0;
                    } else if(val === null){
                    val = 0;
                    }
     return val;

}

function TaxAmountTable()
{

var x = document.getElementById("from_date");
var xx = document.getElementById("to_date");

var from_date = x.value;
var to_date = xx.value;

// var from_date = $("#from_date :selected").val();
// var to_date = $("#to_date :selected").val();

var today_date = new Date();

 var six_month_back = from_date;

today_date_value = ('0' + (today_date.getMonth() + 1)).slice(-2) + '/' + ('0' + today_date.getDate()).slice(-2) + '/' + today_date.getFullYear()  ;

 var f_date = from_date;

 var t_date = to_date;

 console.log("call datesssssssssss");
 console.log(f_date);
 console.log(today_date_value);


callTaxAmountTable(f_date,t_date);

}

function callTaxAmountTable(frm_date,too_date){

 var today_date = new Date();

 var six_month_back = moment().subtract(180, 'days').calendar();

today_date_value = today_date.getFullYear() + '/' + ('0' + (today_date.getMonth() + 1)).slice(-2) + '/' + ('0' + today_date.getDate()).slice(-2);

console.log('date isss');
console.log(today_date_value);
console.log(six_month_back);

 var from_date = frm_date;

 var to_date = too_date;

 var_url = '/api/'+'admin_dashboard_taxable_amount_table'
    $.ajaxSetup({
            headers:{
                'Authorization': "Token {{request.session.admin_access_token}}",
                'usertype': 1
            }

        });

$.post(var_url,{'from_date':from_date,'to_date':to_date},
      function(data)
      {

      //alert(data);

        for (k=0;k<data['Tax'].length;k++)
        {
            console.log("tax amount print");
            console.log(k);
            console.log(data['Tax'][k][0].igst);
            console.log(data['Tax'][k][0].cgst);
            console.log(data['Tax'][k][0].sgst);

            var pre_tax_amt = 0;
            var igst_amt = 0;
            var cgst_amt = 0;
            var sgst_amt = 0;
            var others_amt = 0;
            var total_amt = 0;
            var paid_amt = 0;
            var pending_amt = 0;
            var partial_paid_amt = 0;



            switch(k){

            case 0:

                pre_tax_amt = nullCheck(data['Tax'][k][0].pre_tax_amount);
                igst_amt = nullCheck(data['Tax'][k][0].igst);
                cgst_amt = nullCheck(data['Tax'][k][0].cgst);
                sgst_amt = nullCheck(data['Tax'][k][0].sgst);
                others_amt = nullCheck(data['Tax'][k][0].other_charge);
                total_amt = nullCheck(data['Tax'][k][0].total);


               table_row_str = '<th scope="row">Taxi</th><td>'+ pre_tax_amt + '</td><td>'+ igst_amt + '</td><td>' + cgst_amt +'</td><td>' + sgst_amt + '</td></td>' +
                '<td>' + others_amt + '</td><td>' + total_amt + '</td><td><td>' + paid_amt + '</td><td>' + pending_amt + '</td><td>' + partial_paid_amt + '</td></td>';


                $('#row_taxi').html(table_row_str);

                break;

            case 1:

                pre_tax_amt = nullCheck(data['Tax'][k][0].pre_tax_amount);
                igst_amt = nullCheck(data['Tax'][k][0].igst);
                cgst_amt = nullCheck(data['Tax'][k][0].cgst);
                sgst_amt = nullCheck(data['Tax'][k][0].sgst);
                others_amt = nullCheck(data['Tax'][k][0].other_charge);
                total_amt = nullCheck(data['Tax'][k][0].total);



                table_row_str = '<th scope="row">Bus</th><td>'+ pre_tax_amt + '</td><td>'+ igst_amt + '</td><td>' + cgst_amt +'</td><td>' + sgst_amt + '</td></td>' +
                '<td>' + others_amt + '</td><td>' + total_amt + '</td><td><td>' + paid_amt + '</td><td>' + pending_amt + '</td><td>' + partial_paid_amt + '</td></td>';

                $('#row_bus').html(table_row_str);

                break;

            case 2:

                pre_tax_amt = nullCheck(data['Tax'][k][0].pre_tax_amount);
                igst_amt = nullCheck(data['Tax'][k][0].igst);
                cgst_amt = nullCheck(data['Tax'][k][0].cgst);
                sgst_amt = nullCheck(data['Tax'][k][0].sgst);
                others_amt = nullCheck(data['Tax'][k][0].other_charge);
                total_amt = nullCheck(data['Tax'][k][0].total);



               table_row_str = '<th scope="row">Train</th><td>'+ pre_tax_amt + '</td><td>'+ igst_amt + '</td><td>' + cgst_amt +'</td><td>' + sgst_amt + '</td></td>' +
                '<td>' + others_amt + '</td><td>' + total_amt + '</td><td><td>' + paid_amt + '</td><td>' + pending_amt + '</td><td>' + partial_paid_amt + '</td></td>';

                $('#row_train').html(table_row_str);


                break;

            case 3:

                pre_tax_amt = nullCheck(data['Tax'][k][0].pre_tax_amount);
                igst_amt = nullCheck(data['Tax'][k][0].igst);
                cgst_amt = nullCheck(data['Tax'][k][0].cgst);
                sgst_amt = nullCheck(data['Tax'][k][0].sgst);
                others_amt = nullCheck(data['Tax'][k][0].other_charge);
                total_amt = nullCheck(data['Tax'][k][0].total);



               table_row_str = '<th scope="row">Flight</th><td>'+ pre_tax_amt + '</td><td>'+ igst_amt + '</td><td>' + cgst_amt +'</td><td>' + sgst_amt + '</td></td>' +
                '<td>' + others_amt + '</td><td>' + total_amt + '</td><td><td>' + paid_amt + '</td><td>' + pending_amt + '</td><td>' + partial_paid_amt + '</td></td>';

                $('#row_flight').html(table_row_str);


                break;

            case 4:

                pre_tax_amt = nullCheck(data['Tax'][k][0].pre_tax_amount);
                igst_amt = nullCheck(data['Tax'][k][0].igst);
                cgst_amt = nullCheck(data['Tax'][k][0].cgst);
                sgst_amt = nullCheck(data['Tax'][k][0].sgst);
                others_amt = nullCheck(data['Tax'][k][0].other_charge);
                total_amt = nullCheck(data['Tax'][k][0].total);




               table_row_str = '<th scope="row">Hotel</th><td>'+ pre_tax_amt + '</td><td>'+ igst_amt + '</td><td>' + cgst_amt +'</td><td>' + sgst_amt + '</td></td>' +
                '<td>' + others_amt + '</td><td>' + total_amt + '</td><td><td>' + paid_amt + '</td><td>' + pending_amt + '</td><td>' + partial_paid_amt + '</td></td>';

                $('#row_hotel').html(table_row_str);


                break;

                    }



        }



       });

}


/* end */

</script>


{% endfor %}
{% endblock %}





