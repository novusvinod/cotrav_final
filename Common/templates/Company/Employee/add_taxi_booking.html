{% extends 'Company/Employee/layout/header.html' %}

{% block content %}


{% if user %}
<!-- start page content -->
{% load static %}


{% include 'cotrav_alert_message.html' %}
<div class="page-content-wrapper">
    <div class="page-content">
        <form method="post" action="/Corporate/Employee/add-taxi-booking/{{user.corporate_id}}">
            <input type="hidden" name="employee_id" value="{{user.id}}">
            <input type="hidden" name="spoc_id" value="{{user.spoc_id}}">
            <input type="hidden" name="corporate_id" id="corporate_id" value="{{user.corporate_id}}">
            <input type="hidden" name="entity_id" value="{{user.billing_entity_id}}">
             <input type="hidden" name="current_url" value="{{ request.get_full_path }}">

       <div class="row">
						<div class="col-sm-12">
							<div class="card card-box" style="margin:10px; margin-left:3%; margin-right:3%; ">
								<div class="card-head">
									<header>Booking Details: </header>
                                     <div class="tools">

										<a class="t-collapse btn-color fa fa-chevron-down" href="javascript:;"></a>

                                    </div>
								</div>
								<div class="card-body row">


                                    <div class="col-lg-2 p-t-20">
										<div class = "mdl-textfield mdl-textfield--floating-label txt-full-width is-dirty">
											<select class="mdl-textfield__input js-select2" id="tour_type" name="tour_type" required>
                                                    <option value="">--Select Tour Type--</option>
                                                        {% for corp_acces in corp_access %}

                                                            {% if corp_acces.is_radio == 1 %}
                                                                <option value="1">Radio </option>
                                                            {% endif %}
                                                            {% if corp_acces.is_local == 1 %}
                                                                <option value="2">Local </option>
                                                            {% endif %}
                                                            {% if corp_acces.is_outstation == 1 %}
                                                                <option value="3">Outstation </option>
                                                            {% endif %}

                                                        {% endfor %}

                                            </select>
                                         <label class = "mdl-textfield__label" >Tour Type*</label>
                                       </div>
									</div>

                                    <div class="col-lg-2 p-t-20">
										<div class = "mdl-textfield mdl-textfield--floating-label txt-full-width is-dirty">
											<select class="mdl-textfield__input js-select2" id="current_city_id" name="current_city_id" required>
                                                <option value="">--Select City-- </option>
                                                    {% for cities in citiess %}
                                                     <option value="{{cities.id}}">{{cities.city_name}}</option>
                                                    {% endfor %}
                                            </select>
                                         <label class = "mdl-textfield__label" >Pickup City*</label>
                                       </div>
									</div>

                                    <div class="col-lg-2 p-t-20">
										<div class = "mdl-textfield mdl-textfield--floating-label txt-full-width is-dirty">
											<select class="mdl-textfield__input js-select2" id="select_taxi_type" name="taxi_type" required>
                                                 <option value="">--Select Taxi Type--</option>
                                                    {% for taxi in taxies %}
                                                    <option value="{{taxi.id}}">{{taxi.name}}</option>
                                                    {% endfor %}
                                            </select>
                                         <label class = "mdl-textfield__label" >Taxi Type</label>
                                       </div>
									</div>

                                    <div class="col-lg-2 p-t-20" id="tr_package">
										<div class = "mdl-textfield mdl-textfield--floating-label txt-full-width is-dirty" >
											<select class="mdl-textfield__input js-select2" name="package_id" id="package_id">
                                                <option value="">--Select Package--</option>

                                            </select>
                                         <label class = "mdl-textfield__label" >Select Package</label>
                                       </div>
									</div>

                                     <div class="col-lg-2 p-t-20" id="tr_no_of_days">
						              <div class = "mdl-textfield mdl-textfield--floating-label txt-full-width is-dirty" >
					                     <input class = "mdl-textfield__input" type = "text" name="no_of_days" id="id_no_of_days">
					                     <label class = "mdl-textfield__label">No of Days</label>
					                  </div>
						            </div>

                                     <div class="col-lg-2 p-t-20">
						              <div class = "mdl-textfield mdl-textfield--floating-label txt-full-width is-dirty">
					                     <input class = "mdl-textfield__input" type = "text" name="pickup_location" id="pickup_location" placeholder="" required>
					                     <label class = "mdl-textfield__label">Pickup Location*</label>
					                  </div>
						            </div>

                                     <div class="col-lg-2 p-t-20">
						              <div class = "mdl-textfield mdl-textfield--floating-label txt-full-width is-dirty">
					                     <input class = "mdl-textfield__input date-format" type = "text" name="pickup_datetime" required>
					                     <label class = "mdl-textfield__label">Pickup DateTime*</label>
					                  </div>
						            </div>

                                     <div class="col-lg-2 p-t-20">
						              <div class = "mdl-textfield mdl-textfield--floating-label txt-full-width is-dirty">
					                     <input class = "mdl-textfield__input" type = "text" name="drop_location" id="drop_location" placeholder="" required>
					                     <label class = "mdl-textfield__label">Drop Location*</label>
					                  </div>
						            </div>



                                {% for corp_acces in corp_access %}
                                {% if corp_acces.has_assessment_codes == 1 %}

                                    <div class="col-lg-2 p-t-20">
										<div class = "mdl-textfield mdl-textfield--floating-label txt-full-width is-dirty">
											<select class="mdl-textfield__input js-select2" name="assessment_code" id="assessment_code">
                                                <option value="">--Select Assessment Code--</option>
                                                    {% for assessment in assessments %}
                                                    <option value="{{assessment.id}}">{{assessment.assessment_code}}</option>
                                                    {% endfor %}

                                            </select>
                                         <label class = "mdl-textfield__label" >Assessment Code*</label>
                                       </div>
									</div>



                                    <div class="col-lg-2 p-t-20">
										<div class = "mdl-textfield mdl-textfield--floating-label txt-full-width is-dirty">
											<select class="mdl-textfield__input js-select2" name="assessment_city_id" id="assessment_city_id">
                                                <option value="">--Select Assessment City--</option>
                                                    {% for city in cities %}
                                                    <option value="{{city.id}}">{{city.city_name}}</option>
                                                    {% endfor %}

                                            </select>
                                         <label class = "mdl-textfield__label" >Assessment City*</label>
                                       </div>
									</div>

                              {% endif %}
                              {% endfor %}


                              <div class="col-lg-2 p-t-20">
						              <div class = "mdl-textfield mdl-textfield--floating-label txt-full-width is-dirty">
					                     <textarea class = "mdl-textfield__input" name="reason_booking"> </textarea>
					                     <label class = "mdl-textfield__label">Booking Reason/ Comment*</label>
					                  </div>
						      </div>


                        </div>



                </div>
            </div>


           <div class="col-sm-12">
							<div class="card card-box" style="margin:10px; margin-left:3%; margin-right:3%">
								<div class="card-head">

                                     <div class="tools">

										<a class="t-collapse btn-color fa fa-chevron-down" href="javascript:;"></a>

                                    </div>
								</div> <!-- card-head class end -->

                     <div class="card-body row">



                          <div class="col-lg-12"  align="center">
							              	<button class="btn btn-info mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent" type="submit">
											  Submit
											</button>

                              <button class="btn btn-danger mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent"  >
											  Cancel
											</button>
							            </div>

                     </div>
                 </div>
        </div><!-- row end -->

       </div>
        </form>
    </div></div>


<!-- end page content -->


{% else %}
    <p>Welcome, new user. Please log in.<a href="/login">Login</a> </p>
{% endif %}


<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCCstbhex4F6X2-AXz3B1sR1oRvxssE3sc&libraries=places"></script>

<!--<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCCstbhex4F6X2-AXz3B1sR1oRvxssE3sc&libraries=places"></script>-->


 <script>

  var pickup_location = document.getElementById('pickup_location');
      var autocomplete = new google.maps.places.Autocomplete(pickup_location);

       var drop_location = document.getElementById('drop_location');
      var autocomplete = new google.maps.places.Autocomplete(drop_location);

    </script>

<script type="text/javascript">

$(window).on("load", function () {
var_url = '/api/'+'cities'
    $.ajaxSetup({
            headers:{
                'Authorization': "Token {{request.session.employee_access_token}}",
                'usertype': 6
            }

        });

     $.post(var_url,{},
      function(data)
      {
       //alert(data['Cities']);
       if(data['Cities'].length != 0){
        entities = data['Cities'];
        $('#current_city_id').append($("<option value=''>Select Billing Entity</option>"));
         for (var i=0;i<entities.length;i++) {
            $('#current_city_id').append($("<option value='"+entities[i].id+"'>"+entities[i].city_name+"</option>"));
         }
       }else{
        alert('No Entity Available')
       }
       });

});

$( document ).ready(function() {
    $('#tr_taxi_type').hide();
    $('#tr_package').hide();
    $('#tr_no_of_days').hide();

});

$("#tour_type").change(function()
    {
    	var tour_type = $(this).val();

    	switch(tour_type){
           case '1':
              {
                $('#tr_taxi_type').hide();
                $('#tr_package').hide();
                $('#tr_no_of_days').hide();
                break;
              }
           case '2':
              {
                $('#tr_taxi_type').show();
                $('#tr_package').show();
                $('#tr_no_of_days').hide();
                getPackage();
                break;
              }
           case '3':
              {
                $('#tr_taxi_type').show();
                $('#tr_package').show();
                $('#tr_no_of_days').show();
                getPackage();
                break;
              }
    	}
    });


$("#select_taxi_type").change(function(){
 getPackage();
});


function getPackage(){
$('#package_id').empty();
    var taxi_type =  $("#select_taxi_type").val();
    var corporate_id= $("#corporate_id").val();
    var tour_type= $("#tour_type").val();
    var current_city_id= $("#current_city_id").val();

    if(current_city_id && taxi_type && tour_type && corporate_id)
    {
        if(tour_type != '1')
        {
            $.ajaxSetup({
                headers:{
                    'Authorization': "Token {{request.session.employee_access_token}}",
                    'usertype': {{request.session.employee_login_type}}
                }
            });

            //       For Package

            var_url_spoc = '/api/'+'corporate_package'
             $.post(var_url_spoc,{ corporate_id: corporate_id, taxi_type : taxi_type, city_id:current_city_id, tour_type:tour_type },
              function(data)
              {
               //alert(JSON.stringify(data));
               if(data['Package'].length != 0){
                package = data['Package'];
                 $('#package_id').append($("<option value=''>--Select Package--</option>"));
                 for (var i=0;i<package.length;i++) {
                    $('#package_id').append($("<option value='"+package[i].id+"'>"+package[i].package_name+"</option>"));
                 }
               }else{
               $('#package_id').append($("<option value=''>--Select Package--</option>"));
                alert('No Package Available')
               }
               });
        }
    }


}

</script>

{% endblock %}